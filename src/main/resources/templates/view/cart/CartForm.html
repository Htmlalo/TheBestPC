<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giỏ hàng - TB PC STORE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Welcome Banner - Preserved from TheBestHome */
    .welcome-banner {
      height: 50vh;
      background: linear-gradient(45deg, #1a1a1a, #2d3436);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .welcome-content {
      text-align: center;
      color: white;
      z-index: 2;
    }

    .welcome-title {
      font-size: 3em;
      margin-bottom: 20px;
      animation: fadeInUp 1s ease;
    }

    /* Header */
    header {
      background: #1a1a1a;
      padding: 20px 5%;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      color: white;
      font-size: 1.5em;
      font-weight: bold;
    }

    .nav-links {
      display: flex;
      gap: 30px;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: #00ff87;
    }


    /* Cart Progress Bar */
    .cart-progress {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      flex: 1;
    }

    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute;
      right: -50%;
      top: 25%;
      width: 100%;
      border-top: 2px dashed #ddd;
      z-index: 1;
    }

    .progress-step.active .step-icon {
      background: #00ff87;
      color: #1a1a1a;
    }

    .step-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      z-index: 2;
      transition: all 0.3s;
    }

    .step-label {
      font-size: 0.9em;
      color: #666;
    }

    /* Cart Content */
    .cart-content {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .cart-items {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .cart-item {
      display: grid;
      grid-template-columns: auto 2fr 1fr 1fr auto;
      gap: 20px;
      padding: 20px;
      border-bottom: 1px solid #eee;
      align-items: center;
    }

    .item-image {
      width: 100px;
      height: 100px;
      background: #2d3436;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
    }

    .item-info h3 {
      margin-bottom: 10px;
      color: #1a1a1a;
    }

    .item-specs {
      color: #666;
      font-size: 0.9em;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      border: none;
      background: #f5f5f5;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .quantity-btn:hover {
      background: #e0e0e0;
    }

    .quantity-input {
      width: 50px;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 5px;
    }

    .item-price {
      color: #00ff87;
      font-weight: bold;
      font-size: 1.2em;
    }

    .remove-btn {
      color: #ff4444;
      cursor: pointer;
      transition: color 0.3s;
    }

    .remove-btn:hover {
      color: #cc0000;
    }

    /* Cart Summary */
    .cart-summary {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      color: #666;
    }

    .summary-total {
      font-size: 1.2em;
      color: #1a1a1a;
      font-weight: bold;
      border-top: 2px solid #eee;
      padding-top: 15px;
    }

    .action-buttons {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.3s;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn-primary {
      background: linear-gradient(45deg, #00ff87, #60efff);
      color: #1a1a1a;
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #1a1a1a;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 768px) {
      .cart-item {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .item-image {
        margin: 0 auto;
      }

      .quantity-controls {
        justify-content: center;
      }

      .cart-progress {
        flex-direction: column;
        gap: 20px;
      }

      .progress-step::after {
        display: none;
      }
    }
  </style>
</head>
<body>
<!--  Banner (preserved from TheBestHome) -->
<div class="welcome-banner">
  <div class="welcome-content">
<!--    <h1 class="welcome-title" th:text="${pageTitle}">Giỏ hàng của bạn</h1>-->
    <h1 class="welcome-title" >Giỏ hàng của bạn</h1>
  </div>
</div>
<!-- Header -->
<header>
  <nav>
    <div class="logo">TB PC STORE</div>
    <div class="nav-links">
      <a href="#"><i class="fas fa-search"></i> Tìm kiếm</a>
      <a href="/TheBestPc/cart"><i class="fas fa-clipboard-list"></i> Tra cứu đơn hàng</a>
      <a href="/TheBestPc/cart"><i class="fas fa-shopping-cart"></i> Giỏ hàng</a>
      <a href="/TheBestPc/account"><i class="fas fa-user"></i> Tài khoản</a>
    </div>
  </nav>
</header>
<!-- Cart Progress -->
<div class="cart-progress">
  <div class="progress-step active">
    <div class="step-icon">
      <i class="fas fa-shopping-cart"></i>
    </div>
    <span class="step-label">Giỏ hàng</span>
  </div>
  <div class="progress-step">
    <div class="step-icon">
      <i class="fas fa-info-circle"></i>
    </div>
    <span class="step-label">Thông tin đặt hàng</span>
  </div>
  <div class="progress-step">
    <div class="step-icon">
      <i class="fas fa-credit-card"></i>
    </div>
    <span class="step-label">Thanh toán</span>
  </div>
  <div class="progress-step">
    <div class="step-icon">
      <i class="fas fa-check"></i>
    </div>
    <span class="step-label">Hoàn tất</span>
  </div>
</div>

<!-- Cart Content -->
<div class="cart-content">
  <!-- Cart Items -->
  <div class="cart-items">
    <!-- Thymeleaf iteration for cart items -->
    <div th:each="item : ${cartItems}" class="cart-item">
      <div class="item-image">
        <i class="fas fa-desktop fa-2x" style="color: white;"></i>
      </div>
      <div class="item-info">
        <h3 th:text="${item.name}">PC GVN Intel i5-12400F/ VGA RTX 4060</h3>
        <p class="item-specs" th:text="${item.specs}">
          RTX 4060 • i5-12400F • 16GB RAM • 1TB NVMe
        </p>
      </div>
      <div class="quantity-controls">
        <button class="quantity-btn" th:onclick="'updateQuantity(' + ${item.id} + ', -1)'">-</button>
        <input type="number" class="quantity-input" th:value="${item.quantity}" min="1"
               th:onchange="'updateQuantity(' + ${item.id} + ', this.value)'">
        <button class="quantity-btn" th:onclick="'updateQuantity(' + ${item.id} + ', 1)'">+</button>
      </div>
      <div class="item-price" th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">
        18.190.000đ
      </div>
      <i class="fas fa-times remove-btn" th:onclick="'removeItem(' + ${item.id} + ')'"></i>
    </div>
  </div>

  <!-- Cart Summary -->
  <div class="cart-summary">
    <div class="summary-row">
      <span>Tạm tính:</span>
      <span th:text="${#numbers.formatDecimal(subtotal, 0, 'COMMA', 0, 'POINT')} + 'đ'">18.190.000đ</span>
    </div>
    <div class="summary-row">
      <span>Phí vận chuyển:</span>
      <span th:text="${shipping == 0 ? 'Miễn phí' : #numbers.formatDecimal(shipping, 0, 'COMMA', 0, 'POINT') + 'đ'}">
                    Miễn phí
                </span>
    </div>
    <div class="summary-row">
      <span>Giảm giá:</span>
      <span th:text="${#numbers.formatDecimal(discount, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
    </div>
    <div class="summary-row summary-total">
      <span>Tổng tiền:</span>
      <span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + 'đ'">18.190.000đ</span>
    </div>
    <div class="action-buttons">
      <button class="btn btn-secondary" onclick="window.location.href='/products'">
        <i class="fas fa-arrow-left"></i> Tiếp tục mua sắm
      </button>
      <button class="btn btn-primary" onclick="window.location.href='/checkout/information'">
        Tiến hành đặt hàng <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>
</div>

<script th:inline="javascript">
  // Update quantity function
  function updateQuantity(itemId, change) {
    fetch(`/api/cart/update/${itemId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ quantity: change })
    })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                location.reload();
              }
            });
  }

  // Remove item function
  function removeItem(itemId) {
    if (confirm('Bạn có chắc muốn xóa sản phẩm này?')) {
      fetch(`/api/cart/remove/${itemId}`, {
        method: 'DELETE'
      })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  location.reload();
                }
              });
    }
  }

  // Progress step navigation
  document.querySelectorAll('.progress-step').forEach((step, index) => {
    step.addEventListener('click', () => {
      const steps = ['/cart', '/checkout/information', '/checkout/payment', '/checkout/complete'];
      if (index > 0) { // Only allow forward navigation if cart is not empty
        const cartItems = /*[[${cartItems}]]*/ [];
        if (cartItems && cartItems.length > 0) {
          window.location.href = steps[index];
        }
      }
    });
  });
</script>
</body>
</html>